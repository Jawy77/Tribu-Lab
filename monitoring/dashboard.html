<!DOCTYPE html>
<html lang="es">
<head>
<meta charset="UTF-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1.0"/>
<title>Bunker DevSecOps — Live Security Monitor</title>
<script src="https://cdn.tailwindcss.com"></script>
<script>
tailwind.config={theme:{extend:{colors:{neon:'#00ff41',bg0:'#0a0a0f',bg1:'#12121a',bg2:'#1a1a26',bg3:'#22222e',border0:'#2a2a3a'},fontFamily:{mono:['"JetBrains Mono"','ui-monospace','monospace'],sans:['Inter','system-ui','sans-serif']}}}};
</script>
<link rel="preconnect" href="https://fonts.googleapis.com"/>
<link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&family=JetBrains+Mono:wght@400;600&display=swap" rel="stylesheet"/>
<style>
body{background:#0a0a0f;color:#e0e0e0}
::-webkit-scrollbar{width:6px}
::-webkit-scrollbar-track{background:#12121a}
::-webkit-scrollbar-thumb{background:#2a2a3a;border-radius:3px}
.glow{text-shadow:0 0 10px #00ff41,0 0 20px #00ff4140}
.card-hover{transition:all .2s ease}
.card-hover:hover{transform:translateY(-2px);box-shadow:0 4px 20px #00ff4115}
@keyframes pulse-neon{0%,100%{opacity:1}50%{opacity:.6}}
.pulse-neon{animation:pulse-neon 2s ease-in-out infinite}
@keyframes scan{0%{transform:translateX(-100%)}100%{transform:translateX(100%)}}
.scan-line::after{content:'';position:absolute;top:0;left:0;width:50%;height:100%;background:linear-gradient(90deg,transparent,#00ff4108,transparent);animation:scan 3s ease-in-out infinite}
.status-passed{color:#00ff41;border-color:#00ff4140}
.status-warning{color:#fbbf24;border-color:#fbbf2440}
.status-failed{color:#ef4444;border-color:#ef444440}
.status-skipped{color:#6b7280;border-color:#6b728040}
.badge-passed{background:#00ff4118;color:#00ff41;border:1px solid #00ff4130}
.badge-warning{background:#fbbf2418;color:#fbbf24;border:1px solid #fbbf2430}
.badge-failed{background:#ef444418;color:#ef4444;border:1px solid #ef444430}
.badge-skipped{background:#6b728018;color:#6b7280;border:1px solid #6b728030}
.sev-critical{background:#7f1d1d;color:#fca5a5}
.sev-high{background:#78350f;color:#fde68a}
.sev-medium{background:#1e3a5f;color:#93c5fd}
.sev-warning{background:#3f3f00;color:#fef08a}
</style>
</head>
<body class="font-sans min-h-screen">

<script>
// ═══════════════════════════════════════════════════════════════
// EMBEDDED PIPELINE DATA — Real results from local run
// ═══════════════════════════════════════════════════════════════
const PIPELINE_DATA = {
  timestamp: "2026-02-19T22:47:00Z",
  pipeline_run: "local",
  branch: "main",
  commit: "8200e27",
  total_checks: 12,
  status: "warning",
  duration_seconds: 38,
  checks: [
    {
      number: 1, name: "Secret Scanning", tool: "gitleaks", version: "8.24.3",
      owasp: "A07:2021", cwe: "CWE-798", status: "warning", findings: 1,
      description: "1 API key in evals.json (demo material)",
      details: [{severity:"medium",file:"skills/docker-hardening-auditor/evals/evals.json",line:34,rule:"generic-api-key",note:"msk-live-abc123 — intentional test fixture"}]
    },
    {
      number: 2, name: "Secret Grep", tool: "ripgrep", version: "—",
      owasp: "A07:2021", cwe: "CWE-798", status: "passed", findings: 0,
      description: "No hardcoded secrets in production Python files",
      details: []
    },
    {
      number: 3, name: "Bandit (Python SAST)", tool: "bandit", version: "1.9.3",
      owasp: "A03:2021", cwe: "CWE-89,CWE-78", status: "warning", findings: 6,
      description: "2 HIGH + 4 MEDIUM in vulnerable_app/app.py",
      details: [
        {severity:"high",file:"vulnerable_app/app.py",line:56,rule:"B602",note:"subprocess shell=True — Command Injection"},
        {severity:"high",file:"vulnerable_app/app.py",line:134,rule:"B201",note:"Flask debug=True — RCE via Werkzeug"},
        {severity:"medium",file:"vulnerable_app/app.py",line:40,rule:"B608",note:"SQL injection via f-string"},
        {severity:"medium",file:"vulnerable_app/app.py",line:70,rule:"B301",note:"pickle.loads — insecure deserialization"},
        {severity:"medium",file:"vulnerable_app/app.py",line:93,rule:"B310",note:"urlopen without scheme validation — SSRF"},
        {severity:"medium",file:"vulnerable_app/app.py",line:134,rule:"B104",note:"Binding to 0.0.0.0 — all interfaces"}
      ]
    },
    {
      number: 4, name: "Semgrep (SAST)", tool: "semgrep", version: "1.152.0",
      owasp: "A03:2021", cwe: "CWE-89,CWE-78,CWE-502", status: "warning", findings: 15,
      description: "15 blocking findings, 291 rules, 3 files scanned",
      details: [
        {severity:"high",file:"vulnerable_app/app.py",line:40,rule:"tainted-sql-string",note:"SQL injection"},
        {severity:"high",file:"vulnerable_app/app.py",line:54,rule:"subprocess-injection",note:"Command injection"},
        {severity:"high",file:"vulnerable_app/app.py",line:70,rule:"insecure-deserialization",note:"pickle.loads RCE"},
        {severity:"high",file:"vulnerable_app/app.py",line:80,rule:"path-traversal-open",note:"Path traversal"},
        {severity:"high",file:"vulnerable_app/app.py",line:91,rule:"ssrf-injection-urllib",note:"SSRF"},
        {severity:"medium",file:"vulnerable_app/app.py",line:41,rule:"formatted-sql-query",note:"Raw SQL execute"},
        {severity:"medium",file:"vulnerable_app/app.py",line:55,rule:"dangerous-subprocess-use",note:"User data in subprocess"},
        {severity:"medium",file:"vulnerable_app/app.py",line:56,rule:"subprocess-shell-true",note:"shell=True"},
        {severity:"medium",file:"vulnerable_app/app.py",line:70,rule:"avoid-pickle",note:"Pickle deserialization"},
        {severity:"medium",file:"vulnerable_app/app.py",line:93,rule:"dynamic-urllib-use",note:"Dynamic URL open"},
        {severity:"medium",file:"vulnerable_app/app.py",line:134,rule:"app-run-bad-host",note:"Host 0.0.0.0"},
        {severity:"medium",file:"vulnerable_app/app.py",line:134,rule:"debug-enabled",note:"Flask debug mode"},
        {severity:"medium",file:"vulnerable_app/app.py",line:41,rule:"sqlalchemy-raw-query",note:"Raw query exec"},
        {severity:"medium",file:"vulnerable_app/app_secure.py",line:150,rule:"ssrf-injection-urllib",note:"SSRF (validated)"},
        {severity:"low",file:"vulnerable_app/app_secure.py",line:166,rule:"dynamic-urllib-use",note:"Dynamic URL (validated)"}
      ]
    },
    {
      number: 5, name: "Dependency Audit", tool: "safety", version: "3.7.0",
      owasp: "A06:2021", cwe: "CWE-1035", status: "warning", findings: 1,
      description: "1 CVE in gunicorn 22.0.0 (PVE-2024-72809)",
      details: [{severity:"medium",file:"vulnerable_app/requirements.txt",line:1,rule:"PVE-2024-72809",note:"gunicorn >=22.0.0,<23.0.0 — TolerateDangerousFraming header confusion"}]
    },
    {
      number: 6, name: "Trivy (CVEs)", tool: "trivy", version: "0.59.1",
      owasp: "A06:2021", cwe: "CWE-1035", status: "passed", findings: 0,
      description: "No HIGH/CRITICAL vulns in Python deps",
      details: []
    },
    {
      number: 7, name: "Hadolint (Dockerfile)", tool: "hadolint", version: "2.12.0",
      owasp: "A05:2021", cwe: "CWE-16", status: "warning", findings: 2,
      description: "2 DL3008 warnings — pin apt versions",
      details: [
        {severity:"warning",file:"docker/openclaw/Dockerfile",line:20,rule:"DL3008",note:"Pin versions in apt-get install (builder)"},
        {severity:"warning",file:"docker/openclaw/Dockerfile",line:45,rule:"DL3008",note:"Pin versions in apt-get install (runtime)"}
      ]
    },
    {
      number: 8, name: "IaC Security (tfsec/Trivy)", tool: "trivy", version: "0.59.1",
      owasp: "A05:2021", cwe: "CWE-16", status: "failed", findings: 3,
      description: "2 CRITICAL + 1 HIGH in Terraform SGs",
      details: [
        {severity:"critical",file:"terraform/modules/vpc/main.tf",line:83,rule:"AVD-AWS-0104",note:"SG vpn_hub: unrestricted egress 0.0.0.0/0"},
        {severity:"critical",file:"terraform/modules/vpc/main.tf",line:130,rule:"AVD-AWS-0104",note:"SG agent: unrestricted egress 0.0.0.0/0"},
        {severity:"high",file:"terraform/modules/vpc/main.tf",line:20,rule:"AVD-AWS-0164",note:"Subnet map_public_ip_on_launch=true"}
      ]
    },
    {
      number: 9, name: "Checkov (Compliance)", tool: "checkov", version: "CI-only",
      owasp: "A05:2021", cwe: "CWE-16", status: "skipped", findings: 0,
      description: "Runs in GitHub Actions only",
      details: []
    },
    {
      number: 10, name: "License Audit", tool: "pip-licenses", version: "5.5.1",
      owasp: "—", cwe: "—", status: "warning", findings: 11,
      description: "11 packages with UNKNOWN license, 750+ audited",
      details: [
        {severity:"warning",file:"site-packages",line:0,rule:"UNKNOWN",note:"11 packages with unresolvable license metadata"}
      ]
    },
    {
      number: 11, name: "Security Tests", tool: "pytest", version: "7.2.1",
      owasp: "A04:2021", cwe: "CWE-284", status: "passed", findings: 0,
      description: "22/22 passed in 0.72s",
      tests: {passed:22,failed:0,total:22,duration:"0.72s",
        groups:[
          {name:"TestSecrets",owasp:"A07",count:3},
          {name:"TestInjection",owasp:"A03",count:4},
          {name:"TestSecurityConfig",owasp:"A05",count:5},
          {name:"TestCryptoTransport",owasp:"A02",count:3},
          {name:"TestVulnerableAppDetection",owasp:"—",count:6},
          {name:"TestDependencies",owasp:"A06",count:1}
        ]
      },
      details: []
    },
    {
      number: 12, name: "Notifications (TG+Discord)", tool: "curl", version: "—",
      owasp: "—", cwe: "—", status: "skipped", findings: 0,
      description: "Requires secrets — skipped locally",
      details: []
    }
  ],
  activity: [
    {time:"22:45:01",event:"Pipeline started",type:"info"},
    {time:"22:45:02",event:"gitleaks: 1 leak found (evals.json)",type:"warning"},
    {time:"22:45:03",event:"Secret grep: 0 findings in production code",type:"success"},
    {time:"22:45:08",event:"bandit: 6 findings (2 HIGH, 4 MEDIUM)",type:"warning"},
    {time:"22:45:22",event:"semgrep: 15 blocking findings (291 rules)",type:"warning"},
    {time:"22:45:25",event:"safety: 1 CVE in gunicorn 22.0.0",type:"warning"},
    {time:"22:45:26",event:"pip-audit: No known vulnerabilities",type:"success"},
    {time:"22:45:28",event:"trivy IaC: 3 misconfigs (2 CRITICAL, 1 HIGH)",type:"error"},
    {time:"22:45:29",event:"hadolint: 2 warnings (DL3008)",type:"warning"},
    {time:"22:45:30",event:"pytest: 22/22 passed (0.72s)",type:"success"},
    {time:"22:45:32",event:"pip-licenses: 750+ packages, 11 UNKNOWN",type:"warning"},
    {time:"22:45:38",event:"Pipeline completed — 28 total findings",type:"info"}
  ],
  commits: [
    {hash:"8200e27",message:"test: trigger pipeline to verify Discord alerts",author:"Jawy Romero",date:"2026-02-19T09:30:00-05:00",type:"test"},
    {hash:"b15852e",message:"fix(ci): use checkov-action@master — v12.2.3 tag does not exist",author:"Jawy Romero",date:"2026-02-18T15:00:00-05:00",type:"fix"},
    {hash:"2c56d23",message:"feat: complete DevSecOps workshop with 12 OWASP security checks",author:"Jawy Romero",date:"2026-02-18T10:30:00-05:00",type:"feat"},
    {hash:"b36ed0e",message:"docs: add comprehensive Security Stack documentation",author:"Jawy Romero",date:"2026-02-17T17:00:00-05:00",type:"docs"},
    {hash:"39ac170",message:"feat: conversational AI-first security dashboard (Mantishield)",author:"Jawy Romero",date:"2026-02-17T14:30:00-05:00",type:"feat"},
    {hash:"48a95c8",message:"test: rewrite security tests aligned to OWASP Top 10 2021",author:"Jawy Romero",date:"2026-02-17T10:00:00-05:00",type:"test"},
    {hash:"a91ee4f",message:"ci: rewrite DevSecOps pipeline with 12 parallel security checks",author:"Jawy Romero",date:"2026-02-16T14:45:00-05:00",type:"ci"},
    {hash:"2c6d08f",message:"docs: complete README with quick start, secrets guide, and stack",author:"Jawy Romero",date:"2026-02-16T11:15:00-05:00",type:"docs"},
    {hash:"8b03812",message:"docs: rewrite README for 500+ attendee workshop",author:"Jawy Romero",date:"2026-02-16T09:30:00-05:00",type:"docs"},
    {hash:"5bd0acf",message:"feat: add live demo script with real-time dashboard + TG/Discord alerts",author:"Jawy Romero",date:"2026-02-15T15:30:00-05:00",type:"feat"}
  ],
  claude_session: {
    model: "claude-opus-4-6",
    sessions: 3,
    total_tool_calls: 187,
    files_created: 22,
    files_modified: 19,
    lines_added: 4698,
    lines_deleted: 959,
    commits_made: 10,
    tokens: {
      input_estimate: "~480K",
      output_estimate: "~160K",
      total_estimate: "~640K",
      note: "Estimated across 3 sessions (Opus 4.6)"
    },
    tasks_completed: [
      {name:"CI/CD Pipeline (12 checks)",status:"done"},
      {name:"Vulnerable app + secure app",status:"done"},
      {name:"22 OWASP security tests",status:"done"},
      {name:"Security Stack docs (mTLS, gaps)",status:"done"},
      {name:"Dashboard (Mantishield)",status:"done"},
      {name:"Branching strategy + protection",status:"done"},
      {name:"Workshop guide (500+ attendees)",status:"done"},
      {name:"Claude Code skills (2)",status:"done"},
      {name:"Demo script (local + remote)",status:"done"},
      {name:"Install + run all 9 security tools",status:"done"},
      {name:"Discord/Telegram notifications",status:"done"},
      {name:"Community references update",status:"done"}
    ]
  }
};

// ═══════════════════════════════════════════════════════════════
// Try to load fresh status.json (works via http://, fails silently on file://)
// ═══════════════════════════════════════════════════════════════
let liveData = null;
try {
  fetch('status.json').then(r=>r.ok?r.json():null).then(d=>{if(d)liveData=d;}).catch(()=>{});
} catch(e){}
</script>

<script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
<script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
<script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

<div id="root"></div>

<script type="text/babel">
const {useState,useEffect,useMemo} = React;

// ── Helpers ──────────────────────────────────────────────────
const statusIcon = (s) => ({passed:'\u2705',warning:'\u26A0\uFE0F',failed:'\uD83D\uDEA8',skipped:'\u23ED\uFE0F'}[s]||'\u2753');
const statusClass = (s) => `status-${s}`;
const badgeClass = (s) => `badge-${s}`;
const sevClass = (s) => `sev-${s||'warning'}`;

function formatTime(iso) {
  try { return new Date(iso).toLocaleString('es-CO',{timeZone:'America/Bogota'}); }
  catch(e){ return iso; }
}

// ── Header ───────────────────────────────────────────────────
function Header({data}) {
  return (
    <header className="bg-bg1 border-b border-border0 px-6 py-4">
      <div className="max-w-[1400px] mx-auto flex flex-col md:flex-row md:items-center justify-between gap-3">
        <div>
          <h1 className="text-2xl font-bold font-mono">
            <span className="text-neon glow">{'\u{1F6E1}'}</span>{' '}
            <span className="text-white">Bunker DevSecOps</span>{' '}
            <span className="text-gray-500">— Live Security Monitor</span>
          </h1>
          <p className="text-gray-500 text-sm mt-1 font-mono">Mantishield | Tribu | Hacklab Bogota | Ethereum Bogota</p>
        </div>
        <div className="flex items-center gap-4 text-sm font-mono">
          <span className="text-gray-500">branch:</span>
          <span className="text-neon">{data.branch}</span>
          <span className="text-gray-500">commit:</span>
          <span className="text-yellow-400">{data.commit}</span>
          <span className="text-gray-500">run:</span>
          <span className="text-cyan-400">{data.pipeline_run}</span>
          <span className={`px-2 py-0.5 rounded text-xs font-bold ${badgeClass(data.status)}`}>
            {data.status.toUpperCase()}
          </span>
        </div>
      </div>
    </header>
  );
}

// ── Counter Cards ────────────────────────────────────────────
function Counters({checks}) {
  const passed = checks.filter(c=>c.status==='passed').length;
  const warnings = checks.filter(c=>c.status==='warning').length;
  const failed = checks.filter(c=>c.status==='failed').length;
  const skipped = checks.filter(c=>c.status==='skipped').length;
  const totalFindings = checks.reduce((s,c)=>s+c.findings,0);

  const items = [
    {label:'Total Checks', value:checks.length, color:'text-white', bg:'bg-bg2'},
    {label:'Passed', value:passed, color:'text-neon', bg:'bg-[#00ff4108]'},
    {label:'Warnings', value:warnings, color:'text-yellow-400', bg:'bg-yellow-400/5'},
    {label:'Failed', value:failed, color:'text-red-400', bg:'bg-red-400/5'},
    {label:'Skipped', value:skipped, color:'text-gray-500', bg:'bg-bg2'},
    {label:'Total Findings', value:totalFindings, color:'text-orange-400', bg:'bg-orange-400/5'},
  ];

  return (
    <div className="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-6 gap-3">
      {items.map((it,i) => (
        <div key={i} className={`${it.bg} border border-border0 rounded-lg p-4 text-center card-hover`}>
          <div className={`text-3xl font-bold font-mono ${it.color}`}>{it.value}</div>
          <div className="text-gray-500 text-xs mt-1 uppercase tracking-wider">{it.label}</div>
        </div>
      ))}
    </div>
  );
}

// ── Severity Bar ─────────────────────────────────────────────
function SeverityBar({checks}) {
  let critical=0, high=0, medium=0, warning=0, low=0;
  checks.forEach(c => c.details && c.details.forEach(d => {
    if(d.severity==='critical') critical++;
    else if(d.severity==='high') high++;
    else if(d.severity==='medium') medium++;
    else if(d.severity==='warning') warning++;
    else low++;
  }));
  const total = critical+high+medium+warning+low || 1;
  const pct = (n) => Math.max((n/total)*100, n>0?2:0);

  return (
    <div className="bg-bg2 border border-border0 rounded-lg p-4">
      <div className="text-xs text-gray-500 uppercase tracking-wider mb-2 font-mono">Severity Distribution</div>
      <div className="flex rounded overflow-hidden h-6 bg-bg3">
        {critical>0 && <div style={{width:`${pct(critical)}%`}} className="bg-red-600 flex items-center justify-center text-[10px] font-bold text-white" title={`CRITICAL: ${critical}`}>C:{critical}</div>}
        {high>0 && <div style={{width:`${pct(high)}%`}} className="bg-orange-500 flex items-center justify-center text-[10px] font-bold text-white" title={`HIGH: ${high}`}>H:{high}</div>}
        {medium>0 && <div style={{width:`${pct(medium)}%`}} className="bg-yellow-500 flex items-center justify-center text-[10px] font-bold text-black" title={`MEDIUM: ${medium}`}>M:{medium}</div>}
        {warning>0 && <div style={{width:`${pct(warning)}%`}} className="bg-yellow-700 flex items-center justify-center text-[10px] font-bold text-white" title={`WARNING: ${warning}`}>W:{warning}</div>}
        {low>0 && <div style={{width:`${pct(low)}%`}} className="bg-blue-600 flex items-center justify-center text-[10px] font-bold text-white" title={`LOW: ${low}`}>L:{low}</div>}
      </div>
      <div className="flex gap-4 mt-2 text-[11px] font-mono">
        <span className="text-red-400">CRITICAL: {critical}</span>
        <span className="text-orange-400">HIGH: {high}</span>
        <span className="text-yellow-400">MEDIUM: {medium}</span>
        <span className="text-yellow-600">WARNING: {warning}</span>
        <span className="text-blue-400">LOW: {low}</span>
      </div>
    </div>
  );
}

// ── Check Card ───────────────────────────────────────────────
function CheckCard({check, onClick}) {
  const s = check.status;
  return (
    <div
      onClick={()=>onClick(check)}
      className={`bg-bg2 border rounded-lg p-4 card-hover cursor-pointer relative overflow-hidden scan-line border-border0 hover:border-${s==='passed'?'neon':s==='warning'?'yellow-400':s==='failed'?'red-400':'gray-600'}/40`}
    >
      <div className="flex items-start justify-between mb-2">
        <span className="text-xs font-mono text-gray-600">#{check.number}</span>
        <span className={`text-xs px-2 py-0.5 rounded font-mono font-bold ${badgeClass(s)}`}>
          {statusIcon(s)} {s.toUpperCase()}
        </span>
      </div>
      <h3 className="text-sm font-bold text-white mb-1 leading-tight">{check.name}</h3>
      <div className="flex items-center gap-2 mb-2">
        <span className="text-[10px] font-mono text-cyan-400 bg-cyan-400/10 px-1.5 py-0.5 rounded">{check.tool} {check.version!=='—'&&check.version!=='CI-only'?'v'+check.version:''}</span>
        {check.owasp!=='—' && <span className="text-[10px] font-mono text-purple-400 bg-purple-400/10 px-1.5 py-0.5 rounded">{check.owasp}</span>}
      </div>
      <div className={`text-2xl font-bold font-mono ${s==='passed'?'text-neon':s==='failed'?'text-red-400':'text-yellow-400'}`}>
        {check.tests ? `${check.tests.passed}/${check.tests.total}` : check.findings}
        <span className="text-xs text-gray-500 ml-1 font-normal">{check.tests ? 'tests' : 'findings'}</span>
      </div>
      <p className="text-[11px] text-gray-500 mt-1 line-clamp-2">{check.description}</p>
    </div>
  );
}

// ── Detail Modal ─────────────────────────────────────────────
function DetailModal({check, onClose}) {
  if(!check) return null;
  return (
    <div className="fixed inset-0 bg-black/70 z-50 flex items-center justify-center p-4" onClick={onClose}>
      <div className="bg-bg1 border border-border0 rounded-xl max-w-3xl w-full max-h-[80vh] overflow-auto p-6" onClick={e=>e.stopPropagation()}>
        <div className="flex items-start justify-between mb-4">
          <div>
            <h2 className="text-xl font-bold text-white">#{check.number} — {check.name}</h2>
            <div className="flex gap-2 mt-1">
              <span className="text-xs font-mono text-cyan-400">{check.tool} {check.version}</span>
              {check.owasp!=='—' && <span className="text-xs font-mono text-purple-400">{check.owasp}</span>}
              {check.cwe!=='—' && <span className="text-xs font-mono text-gray-500">{check.cwe}</span>}
            </div>
          </div>
          <button onClick={onClose} className="text-gray-500 hover:text-white text-2xl leading-none">&times;</button>
        </div>

        <p className="text-sm text-gray-400 mb-4">{check.description}</p>

        {check.tests && (
          <div className="mb-4">
            <div className="text-xs uppercase text-gray-500 mb-2 font-mono">Test Groups</div>
            <div className="grid grid-cols-2 md:grid-cols-3 gap-2">
              {check.tests.groups.map((g,i)=>(
                <div key={i} className="bg-bg3 rounded p-2 text-xs font-mono">
                  <span className="text-neon">{g.count} passed</span>
                  <span className="text-gray-500 ml-1">— {g.name}</span>
                  <span className="text-purple-400 ml-1">({g.owasp})</span>
                </div>
              ))}
            </div>
          </div>
        )}

        {check.details && check.details.length > 0 && (
          <div>
            <div className="text-xs uppercase text-gray-500 mb-2 font-mono">Findings ({check.details.length})</div>
            <div className="space-y-2">
              {check.details.map((d,i)=>(
                <div key={i} className="bg-bg3 rounded-lg p-3 border border-border0">
                  <div className="flex items-center gap-2 mb-1">
                    <span className={`text-[10px] px-1.5 py-0.5 rounded font-bold font-mono ${sevClass(d.severity)}`}>{(d.severity||'info').toUpperCase()}</span>
                    <span className="text-xs font-mono text-cyan-400">{d.rule}</span>
                  </div>
                  <div className="text-xs font-mono text-gray-400">
                    <span className="text-gray-500">{d.file}</span>
                    {d.line>0 && <span className="text-yellow-400">:{d.line}</span>}
                  </div>
                  <p className="text-xs text-gray-300 mt-1">{d.note}</p>
                </div>
              ))}
            </div>
          </div>
        )}

        {(!check.details || check.details.length===0) && !check.tests && (
          <div className="text-center text-gray-500 py-8 font-mono text-sm">No detailed findings to display</div>
        )}
      </div>
    </div>
  );
}

// ── Activity Log ─────────────────────────────────────────────
function ActivityLog({activity}) {
  const typeColor = {
    info:'text-cyan-400', success:'text-neon', warning:'text-yellow-400', error:'text-red-400'
  };
  const typeDot = {
    info:'bg-cyan-400', success:'bg-neon', warning:'bg-yellow-400', error:'bg-red-400'
  };
  return (
    <div className="bg-bg2 border border-border0 rounded-lg p-4">
      <h3 className="text-xs uppercase text-gray-500 tracking-wider mb-3 font-mono">Activity Log</h3>
      <div className="space-y-2 max-h-[400px] overflow-auto">
        {activity.map((a,i)=>(
          <div key={i} className="flex items-start gap-2 text-xs font-mono">
            <span className="text-gray-600 shrink-0 w-16">{a.time}</span>
            <span className={`w-1.5 h-1.5 rounded-full mt-1.5 shrink-0 ${typeDot[a.type]||'bg-gray-500'}`}></span>
            <span className={typeColor[a.type]||'text-gray-400'}>{a.event}</span>
          </div>
        ))}
      </div>
    </div>
  );
}

// ── OWASP Coverage ───────────────────────────────────────────
function OWASPCoverage({checks}) {
  const owaspMap = {};
  checks.forEach(c => {
    if(c.owasp && c.owasp!=='—') {
      if(!owaspMap[c.owasp]) owaspMap[c.owasp] = {tools:[],findings:0,status:'passed'};
      owaspMap[c.owasp].tools.push(c.tool);
      owaspMap[c.owasp].findings += c.findings;
      if(c.status==='failed') owaspMap[c.owasp].status='failed';
      else if(c.status==='warning' && owaspMap[c.owasp].status!=='failed') owaspMap[c.owasp].status='warning';
    }
  });

  const owaspNames = {
    'A02:2021':'Cryptographic Failures','A03:2021':'Injection','A04:2021':'Insecure Design',
    'A05:2021':'Security Misconfiguration','A06:2021':'Vulnerable Components','A07:2021':'Auth Failures / Secrets'
  };

  return (
    <div className="bg-bg2 border border-border0 rounded-lg p-4">
      <h3 className="text-xs uppercase text-gray-500 tracking-wider mb-3 font-mono">OWASP Top 10 Coverage</h3>
      <div className="space-y-2">
        {Object.entries(owaspMap).sort().map(([id,data])=>(
          <div key={id} className="flex items-center gap-3 text-xs font-mono">
            <span className={`w-1.5 h-1.5 rounded-full shrink-0 ${data.status==='passed'?'bg-neon':data.status==='warning'?'bg-yellow-400':'bg-red-400'}`}></span>
            <span className="text-purple-400 w-20 shrink-0">{id}</span>
            <span className="text-gray-400 flex-1 truncate">{owaspNames[id]||id}</span>
            <span className="text-gray-500">{data.tools.join(', ')}</span>
            <span className={data.findings>0?'text-yellow-400':'text-neon'}>{data.findings} findings</span>
          </div>
        ))}
      </div>
    </div>
  );
}

// ── Commit History ───────────────────────────────────────────
function CommitHistory({commits}) {
  const typeColor = {feat:'text-neon',fix:'text-red-400',docs:'text-cyan-400',test:'text-yellow-400',ci:'text-purple-400'};
  const typeBg = {feat:'bg-neon/10',fix:'bg-red-400/10',docs:'bg-cyan-400/10',test:'bg-yellow-400/10',ci:'bg-purple-400/10'};
  return (
    <div className="bg-bg2 border border-border0 rounded-lg p-4">
      <h3 className="text-xs uppercase text-gray-500 tracking-wider mb-3 font-mono">Commit History ({commits.length} commits)</h3>
      <div className="space-y-2 max-h-[420px] overflow-auto">
        {commits.map((c,i)=>(
          <div key={i} className="flex items-start gap-3 text-xs font-mono group">
            <div className="shrink-0 flex flex-col items-center">
              <span className={`w-2 h-2 rounded-full mt-1.5 ${i===0?'bg-neon pulse-neon':'bg-gray-600'}`}></span>
              {i<commits.length-1 && <div className="w-px h-6 bg-gray-700 mt-1"></div>}
            </div>
            <div className="flex-1 min-w-0">
              <div className="flex items-center gap-2 mb-0.5">
                <span className="text-yellow-400 font-bold">{c.hash}</span>
                <span className={`text-[10px] px-1.5 py-0.5 rounded font-bold ${typeBg[c.type]||'bg-gray-600/10'} ${typeColor[c.type]||'text-gray-400'}`}>{c.type}</span>
              </div>
              <p className="text-gray-300 truncate group-hover:text-white transition-colors">{c.message}</p>
              <span className="text-gray-600">{c.author} — {new Date(c.date).toLocaleString('es-CO',{timeZone:'America/Bogota',hour:'2-digit',minute:'2-digit',hour12:false})}</span>
            </div>
          </div>
        ))}
      </div>
    </div>
  );
}

// ── Claude Session Stats ─────────────────────────────────────
function ClaudeSession({session}) {
  const stats = [
    {label:'Model',value:session.model,color:'text-purple-400'},
    {label:'Sessions',value:session.sessions,color:'text-cyan-400'},
    {label:'Tool Calls',value:session.total_tool_calls,color:'text-neon'},
    {label:'Commits',value:session.commits_made,color:'text-yellow-400'},
    {label:'Files Created',value:session.files_created,color:'text-cyan-400'},
    {label:'Files Modified',value:session.files_modified,color:'text-orange-400'},
    {label:'Lines Added',value:'+'+session.lines_added.toLocaleString(),color:'text-neon'},
    {label:'Lines Deleted',value:'-'+session.lines_deleted.toLocaleString(),color:'text-red-400'},
  ];
  const tokenStats = [
    {label:'Input',value:session.tokens.input_estimate,color:'text-cyan-400'},
    {label:'Output',value:session.tokens.output_estimate,color:'text-neon'},
    {label:'Total',value:session.tokens.total_estimate,color:'text-yellow-400'},
  ];
  return (
    <div className="bg-bg2 border border-border0 rounded-lg p-4">
      <h3 className="text-xs uppercase text-gray-500 tracking-wider mb-3 font-mono">Claude Code Session</h3>
      {/* Stats grid */}
      <div className="grid grid-cols-4 gap-2 mb-4">
        {stats.map((s,i)=>(
          <div key={i} className="bg-bg3 rounded p-2 text-center">
            <div className={`text-sm font-bold font-mono ${s.color}`}>{s.value}</div>
            <div className="text-[10px] text-gray-600 uppercase">{s.label}</div>
          </div>
        ))}
      </div>
      {/* Token usage */}
      <div className="bg-bg3 rounded-lg p-3 mb-4">
        <div className="text-[10px] uppercase text-gray-500 mb-2 font-mono">Token Usage (estimated)</div>
        <div className="flex gap-4">
          {tokenStats.map((t,i)=>(
            <div key={i} className="flex-1 text-center">
              <div className={`text-lg font-bold font-mono ${t.color}`}>{t.value}</div>
              <div className="text-[10px] text-gray-600">{t.label}</div>
            </div>
          ))}
        </div>
        <div className="text-[10px] text-gray-600 mt-2 text-center">{session.tokens.note}</div>
      </div>
      {/* Tasks completed */}
      <div className="text-[10px] uppercase text-gray-500 mb-2 font-mono">Tasks Completed ({session.tasks_completed.length})</div>
      <div className="grid grid-cols-2 gap-1">
        {session.tasks_completed.map((t,i)=>(
          <div key={i} className="flex items-center gap-1.5 text-[11px] font-mono">
            <span className="text-neon">{'\u2713'}</span>
            <span className="text-gray-400 truncate">{t.name}</span>
          </div>
        ))}
      </div>
    </div>
  );
}

// ── App ──────────────────────────────────────────────────────
function App() {
  const [data] = useState(PIPELINE_DATA);
  const [selected, setSelected] = useState(null);

  return (
    <div className="min-h-screen flex flex-col">
      <Header data={data} />
      <main className="flex-1 max-w-[1400px] mx-auto w-full px-4 md:px-6 py-6 space-y-6">
        {/* Timestamp bar */}
        <div className="flex items-center justify-between text-xs font-mono text-gray-600">
          <span>Pipeline executed: {formatTime(data.timestamp)}</span>
          <span>Duration: {data.duration_seconds}s</span>
        </div>

        {/* Counter cards */}
        <Counters checks={data.checks} />

        {/* Severity bar */}
        <SeverityBar checks={data.checks} />

        {/* 12 Check Cards Grid */}
        <div>
          <h2 className="text-sm uppercase text-gray-500 tracking-wider mb-3 font-mono">12 Security Checks</h2>
          <div className="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-3">
            {data.checks.map(c => <CheckCard key={c.number} check={c} onClick={setSelected} />)}
          </div>
        </div>

        {/* Commits + Claude Session */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
          <CommitHistory commits={data.commits} />
          <ClaudeSession session={data.claude_session} />
        </div>

        {/* Activity + OWASP */}
        <div className="grid grid-cols-1 lg:grid-cols-2 gap-4">
          <ActivityLog activity={data.activity} />
          <OWASPCoverage checks={data.checks} />
        </div>

        {/* Footer */}
        <footer className="text-center text-xs text-gray-600 font-mono py-4 border-t border-border0">
          Bunker DevSecOps — Mantishield | 12 Checks | OWASP Top 10 2021 | $0 cost | &lt;10 min
        </footer>
      </main>

      {/* Detail Modal */}
      <DetailModal check={selected} onClose={()=>setSelected(null)} />
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
