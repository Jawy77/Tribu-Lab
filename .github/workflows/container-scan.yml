# =============================================================================
# üê≥ Container Security Scan ‚Äî Workflow dedicado
# Se ejecuta cuando cambian Dockerfiles o docker-compose
# =============================================================================

name: "üê≥ Container Scan"

on:
  push:
    paths:
      - "docker/**"
      - "docker-compose*.yml"
  pull_request:
    paths:
      - "docker/**"

jobs:
  scan-openclaw:
    name: "Scan OpenClaw Container"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Build OpenClaw image
        run: docker build -t openclaw-hardened:test -f docker/openclaw/Dockerfile .

      - name: Trivy scan
        uses: aquasecurity/trivy-action@master
        with:
          image-ref: "openclaw-hardened:test"
          format: "table"
          exit-code: "1"
          severity: "CRITICAL"

      - name: Dockle - Best practices
        uses: erzz/dockle-action@v1
        continue-on-error: true
        with:
          image: "openclaw-hardened:test"
          exit-code: "0"
          failure-threshold: FATAL
